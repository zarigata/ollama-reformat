{% extends "base.html" %}

{% block title %}One Ring AI - Ollama Fine-Tuning{% endblock %}

{% block head %}
<style>
    .card-hover:hover {
        transform: translateY(-5px);
        box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }
    .card-hover {
        transition: all 0.3s ease;
    }
</style>
{% endblock %}

{% block content %}
<div x-data="{ activeTab: 'installed' }">
    <!-- Hero Section -->
    <div class="bg-gradient-to-r from-indigo-600 to-purple-600 rounded-lg shadow-lg mb-8 p-6 text-white">
        <div class="max-w-3xl mx-auto text-center">
            <h1 class="text-3xl font-bold mb-2">One Ring AI Platform</h1>
            <p class="text-lg mb-4">Fine-tune your Ollama models with advanced features and a modern UI</p>
            <div class="bg-white/20 p-2 rounded-lg inline-flex items-center">
                <i class="fas fa-microchip mr-2"></i>
                <span>Running on: 
                    {% if config.hardware.cuda.available %}
                    <span class="font-bold text-green-200">CUDA - {{ config.hardware.cuda.devices[0].name }}</span>
                    {% elif config.hardware.zluda.available %}
                    <span class="font-bold text-blue-200">ZLUDA</span>
                    {% else %}
                    <span class="font-bold text-yellow-200">CPU - {{ config.hardware.cpu.name }}</span>
                    {% endif %}
                </span>
            </div>
        </div>
    </div>

    <!-- Quick Actions -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
        <!-- Fine-Tune Model -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 card-hover">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">Fine-Tune Model</h2>
                <div class="bg-indigo-100 dark:bg-indigo-900 p-2 rounded-full text-indigo-600 dark:text-indigo-400">
                    <i class="fas fa-wand-magic-sparkles"></i>
                </div>
            </div>
            <p class="text-gray-600 dark:text-gray-300 mb-4">Customize and enhance your models with fine-tuning</p>
            <a href="/fine-tune" class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:underline">
                Start Fine-Tuning <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
        
        <!-- Import Data -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 card-hover">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">Import Data</h2>
                <div class="bg-green-100 dark:bg-green-900 p-2 rounded-full text-green-600 dark:text-green-400">
                    <i class="fas fa-file-import"></i>
                </div>
            </div>
            <p class="text-gray-600 dark:text-gray-300 mb-4">Import PDFs and other data sources for training</p>
            <a href="/data-import" class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:underline">
                Import Data <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
        
        <!-- Download Models -->
        <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 card-hover">
            <div class="flex items-center justify-between mb-4">
                <h2 class="text-xl font-semibold">Download Models</h2>
                <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded-full text-blue-600 dark:text-blue-400">
                    <i class="fas fa-download"></i>
                </div>
            </div>
            <p class="text-gray-600 dark:text-gray-300 mb-4">Search and download models from Ollama</p>
            <a href="/models?tab=download" class="inline-flex items-center text-indigo-600 dark:text-indigo-400 hover:underline">
                Browse Models <i class="fas fa-arrow-right ml-2"></i>
            </a>
        </div>
    </div>

    <!-- Models Section -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 mb-8">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold">Models</h2>
            <div class="flex space-x-2">
                <button @click="activeTab = 'installed'" :class="{'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300': activeTab === 'installed', 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': activeTab !== 'installed'}" class="px-4 py-2 rounded-md text-sm font-medium">
                    Installed
                </button>
                <button @click="activeTab = 'popular'" :class="{'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300': activeTab === 'popular', 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': activeTab !== 'popular'}" class="px-4 py-2 rounded-md text-sm font-medium">
                    Popular
                </button>
                <button @click="activeTab = 'search'" :class="{'bg-indigo-100 dark:bg-indigo-900 text-indigo-700 dark:text-indigo-300': activeTab === 'search', 'bg-gray-100 dark:bg-gray-700 text-gray-700 dark:text-gray-300': activeTab !== 'search'}" class="px-4 py-2 rounded-md text-sm font-medium">
                    Search
                </button>
            </div>
        </div>

        <!-- Search Bar (visible only in search tab) -->
        <div x-show="activeTab === 'search'" class="mb-6">
            <div class="relative">
                <input type="text" placeholder="Search for models..." class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md focus:ring-indigo-500 focus:border-indigo-500 bg-white dark:bg-gray-700 text-gray-900 dark:text-white">
                <button class="absolute right-2 top-2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-200">
                    <i class="fas fa-search"></i>
                </button>
            </div>
        </div>

        <!-- Installed Models Tab -->
        <div x-show="activeTab === 'installed'" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="installed-models">
                <!-- This will be populated by JavaScript -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">llama3</h3>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded">8B</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Meta's Llama 3 model</p>
                    <div class="flex justify-between items-center">
                        <button class="text-indigo-600 dark:text-indigo-400 hover:underline text-sm">Fine-tune</button>
                        <div class="flex space-x-2">
                            <button class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">mistral</h3>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded">7B</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Mistral AI's base model</p>
                    <div class="flex justify-between items-center">
                        <button class="text-indigo-600 dark:text-indigo-400 hover:underline text-sm">Fine-tune</button>
                        <div class="flex space-x-2">
                            <button class="text-gray-500 dark:text-gray-400 hover:text-gray-700 dark:hover:text-gray-200">
                                <i class="fas fa-info-circle"></i>
                            </button>
                            <button class="text-red-500 hover:text-red-700">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Popular Models Tab -->
        <div x-show="activeTab === 'popular'" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="popular-models">
                <!-- This will be populated by JavaScript -->
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">llama3</h3>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded">8B</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Meta's Llama 3 model</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">
                            <i class="fas fa-download mr-1"></i> 50K+
                        </span>
                        <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">
                            Download
                        </button>
                    </div>
                </div>
                
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">mistral</h3>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded">7B</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Mistral AI's base model</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">
                            <i class="fas fa-download mr-1"></i> 45K+
                        </span>
                        <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">
                            Download
                        </button>
                    </div>
                </div>
                
                <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 flex flex-col">
                    <div class="flex items-center justify-between mb-2">
                        <h3 class="text-lg font-medium">codellama</h3>
                        <span class="bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200 text-xs px-2 py-1 rounded">7B</span>
                    </div>
                    <p class="text-sm text-gray-600 dark:text-gray-400 mb-4 flex-grow">Meta's Code Llama for coding tasks</p>
                    <div class="flex justify-between items-center">
                        <span class="text-sm text-gray-500 dark:text-gray-400">
                            <i class="fas fa-download mr-1"></i> 30K+
                        </span>
                        <button class="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-1 rounded text-sm">
                            Download
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search Results Tab -->
        <div x-show="activeTab === 'search'" class="space-y-4">
            <p class="text-gray-500 dark:text-gray-400 text-center py-4">Enter a search term to find models</p>
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4" id="search-results">
                <!-- This will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Fine-Tuning Options -->
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
        <h2 class="text-2xl font-bold mb-6">Fine-Tuning Options</h2>
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <!-- Jailbreak Fine-Tuning -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-indigo-500 dark:hover:border-indigo-400 transition-colors">
                <div class="flex items-center mb-4">
                    <div class="bg-red-100 dark:bg-red-900 p-2 rounded-full text-red-600 dark:text-red-400 mr-3">
                        <i class="fas fa-unlock"></i>
                    </div>
                    <h3 class="text-lg font-medium">Jailbreak</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Apply the latest jailbreak prompts to remove model restrictions
                </p>
                <a href="/fine-tune/jailbreak" class="text-indigo-600 dark:text-indigo-400 hover:underline text-sm inline-flex items-center">
                    Configure <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
            
            <!-- Data Import Fine-Tuning -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-indigo-500 dark:hover:border-indigo-400 transition-colors">
                <div class="flex items-center mb-4">
                    <div class="bg-green-100 dark:bg-green-900 p-2 rounded-full text-green-600 dark:text-green-400 mr-3">
                        <i class="fas fa-database"></i>
                    </div>
                    <h3 class="text-lg font-medium">Data Import</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Fine-tune with your own data from PDFs and other sources
                </p>
                <a href="/fine-tune/data-import" class="text-indigo-600 dark:text-indigo-400 hover:underline text-sm inline-flex items-center">
                    Configure <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
            
            <!-- General Fine-Tuning -->
            <div class="border border-gray-200 dark:border-gray-700 rounded-lg p-4 hover:border-indigo-500 dark:hover:border-indigo-400 transition-colors">
                <div class="flex items-center mb-4">
                    <div class="bg-blue-100 dark:bg-blue-900 p-2 rounded-full text-blue-600 dark:text-blue-400 mr-3">
                        <i class="fas fa-sliders"></i>
                    </div>
                    <h3 class="text-lg font-medium">General Fine-Tuning</h3>
                </div>
                <p class="text-sm text-gray-600 dark:text-gray-400 mb-4">
                    Grade and improve model responses with iterative training
                </p>
                <a href="/fine-tune/general" class="text-indigo-600 dark:text-indigo-400 hover:underline text-sm inline-flex items-center">
                    Configure <i class="fas fa-arrow-right ml-2"></i>
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle mobile menu
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenu = document.getElementById('mobile-menu');
        
        if (mobileMenuButton && mobileMenu) {
            mobileMenuButton.addEventListener('click', function() {
                mobileMenu.classList.toggle('hidden');
            });
        }
        
        // Toggle dark mode
        const themeToggle = document.getElementById('theme-toggle');
        
        if (themeToggle) {
            themeToggle.addEventListener('click', function() {
                document.documentElement.classList.toggle('dark');
                localStorage.setItem('theme', 
                    document.documentElement.classList.contains('dark') ? 'dark' : 'light'
                );
            });
            
            // Set initial theme based on localStorage or system preference
            if (localStorage.getItem('theme') === 'dark' || 
                (!localStorage.getItem('theme') && window.matchMedia('(prefers-color-scheme: dark)').matches)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        }
        
        // Update hardware indicator based on config
        const hardwareType = document.getElementById('hardware-type');
        const hardwareIndicator = document.getElementById('hardware-indicator');
        
        if (hardwareType && hardwareIndicator) {
            // This would be populated with actual data from the backend
            // For now, we're using placeholder logic
            fetch('/api/hardware')
                .then(response => response.json())
                .then(data => {
                    if (data.cuda && data.cuda.available) {
                        hardwareType.textContent = 'CUDA';
                        hardwareIndicator.className = 'px-2 py-1 rounded-md text-sm font-medium bg-green-100 text-green-800 dark:bg-green-800 dark:text-green-100';
                    } else if (data.zluda && data.zluda.available) {
                        hardwareType.textContent = 'ZLUDA';
                        hardwareIndicator.className = 'px-2 py-1 rounded-md text-sm font-medium bg-blue-100 text-blue-800 dark:bg-blue-800 dark:text-blue-100';
                    } else {
                        hardwareType.textContent = 'CPU';
                        hardwareIndicator.className = 'px-2 py-1 rounded-md text-sm font-medium bg-yellow-100 text-yellow-800 dark:bg-yellow-800 dark:text-yellow-100';
                    }
                })
                .catch(error => {
                    console.error('Error fetching hardware info:', error);
                    hardwareType.textContent = 'Unknown';
                });
        }
        
        // Fetch and display models
        // This would be replaced with actual API calls to the Ollama server
        function fetchInstalledModels() {
            fetch('/api/models/installed')
                .then(response => response.json())
                .then(data => {
                    // Populate installed models
                })
                .catch(error => console.error('Error fetching installed models:', error));
        }
        
        function fetchPopularModels() {
            fetch('/api/models/popular')
                .then(response => response.json())
                .then(data => {
                    // Populate popular models
                })
                .catch(error => console.error('Error fetching popular models:', error));
        }
        
        // Initial data load
        // fetchInstalledModels();
        // fetchPopularModels();
    });
</script>
{% endblock %}
